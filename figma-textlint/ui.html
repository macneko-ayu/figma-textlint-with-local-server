<h2>Figma TextLint</h2>
<p>
    <label for="file">Token file:</label>
    <input type="file" id="file" name="file">
</p>
<button id="execute">Execute</button>
<button id="cancel">Cancel</button>
<script>
  const reader = new FileReader();
  const input = document.getElementById('file');
  let token = '';

  input.addEventListener('change', () => {
    reader.readAsText(input.files[0], 'UTF-8');
    reader.onload = () => {
      token = reader.result;
    };
  });

  document.getElementById('execute').onclick = () => {
    parent.postMessage({pluginMessage: {type: 'execute'}}, '*');
  }

  document.getElementById('cancel').onclick = () => {
    parent.postMessage({pluginMessage: {type: 'complete'}}, '*');
  }

  onmessage = (event) => {
    if (event.data.pluginMessage.type !== 'send-text') return;

    const text = event.data.pluginMessage.data;

    const request = new XMLHttpRequest();
    request.open('POST', 'http://localhost:3000/v1/textlint');
    request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    request.responseType = 'json';
    request.onload = () => {
      console.log(request.response);
    };
    request.send(`text=${text}`);
  }
</script>
